以下のファイルを作成します。

invalid_start.php
```php
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>session_start()</title>
  </head>
  <body>
    <h1>実験</h1>
    <?php
      session_start();
    ?>
  </body>
</html>
```

このファイルをpublic_htmlにおいて、
ブラウザでアクセスすると

Warning: session_start(): Cannot send session cookie - headers already sent by (output started at session.php:8) in ・・・

のようなWarningが出るという記事があるのですが、

自分の環境では何も出ません。
なぜでしょうか。

自分の環境
OS: Ubuntu 24.04.2 LTS
PHP: version 8.3.6


---

良い観察ですね。`session_start()` に関する Warning（特に「headers already sent」）が出ない理由は、**あなたの環境のPHP設定やブラウザ・エラーレポートの設定による**可能性が高いです。順を追って説明します。

---

## 🔍 まず「headers already sent」エラーとは？

PHPの `session_start()` は **HTTPヘッダを送信する処理**です。PHPでは、ヘッダは**HTMLの出力より前**に送る必要があります。ところが、HTML出力（例えば `echo` や `<!DOCTYPE html>` のような記述）が先に出力されていると、PHPはヘッダを送れなくなり、エラーになります。

---

## 🤔 でも今回のコードはどうなの？

```php
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>session_start()</title>
  </head>
  <body>
    <h1>実験</h1>
    <?php
      session_start();
    ?>
  </body>
</html>
```

このように **HTML出力が先にある**ので、本来は `session_start()` により「ヘッダが送れません」という Warning が出てもおかしくありません。

---

## 🤓 なのに出ないのはなぜ？

いくつかの可能性があります。

### ✅ 1. **出力バッファリング（Output Buffering）が有効**

PHPでは `output_buffering` という設定があり、**スクリプトの出力を一時的にバッファに貯めておく機能**があります。これが有効になっていると、PHPは実際の出力をすぐに送信せず、`session_start()` を呼び出しても問題にならないケースがあります。

#### 確認方法:
ターミナルで以下を実行してみてください：

```bash
php -i | grep output_buffering
```

出力例：
```
output_buffering => 4096 => 4096
```

→ `4096` のような数値が出ていれば、**有効**になっています。

---

### ✅ 2. **`display_errors` がオフになっている**

Warningは出ているけど、**ブラウザに表示されないだけ**という可能性もあります。PHPの `display_errors` が `Off` の場合、エラーはログに記録されるだけで、ブラウザに出ません。

#### 確認方法:

```bash
php -i | grep display_errors
```

→ `display_errors => Off => Off` なら、表示されません。

---

### ✅ 3. **PHPが内部的にHTML出力をヘッダ送信前と判断しているケース**

これは稀ですが、**PHPがまだ出力をフラッシュしていない**と判断して、警告を出さない場合もあります。特にバッファリングと連動して挙動が変わります。

---

### ✅ 4. **エラー報告レベル（error_reporting）の設定**

PHPは `E_WARNING` レベルのエラーを抑制できるようになっています。

```bash
php -i | grep error_reporting
```

→ `error_reporting => E_ALL & ~E_NOTICE` のようになっているか確認しましょう。

---

## ✅ 結論

**おそらくあなたの環境では `output_buffering` が有効**になっており、そのため `session_start()` を後から書いてもWarningが出ないのです。

---

## 🔧 試したいこと

以下のように、**PHPの先頭に `session_start()` を移動してみる**と、エラーの根本を避けられます。

```php
<?php
  session_start();
?>
<!DOCTYPE html>
<html lang="ja">
  ...
```

また、わざとバッファリングを切って動作確認するには `.htaccess` で以下を追加します：

```apacheconf
php_flag output_buffering Off
```

---

必要なら `phpinfo()` で全設定を可視化してもOKです。

---

気になるようでしたら、設定ファイルの場所や調査方法も案内しますよ！

